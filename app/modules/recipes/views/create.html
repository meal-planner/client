<md-toolbar class="md-hue-3">
  <h2 class="md-toolbar-tools">
    <span>Create New Recipe</span>
  </h2>
</md-toolbar>
<md-content class="md-padding" ng-controller="RecipeCreateController as ctrl">
  <form name="recipeForm" ng-submit="ctrl.createRecipe()">
    <div layout>
      <md-input-container flex>
        <label>Name</label>
        <input type="text" ng-model="recipe.name" required placeholder="Recipe name, e.g. Pasta carbonara">
      </md-input-container>
    </div>
    <p class="md-subhead">Ingredients</p>
    <md-autocomplete
      md-delay="300"
      md-selected-item="ctrl.selectedItem"
      md-selected-item-change="ctrl.addIngredient(item)"
      md-search-text="ctrl.searchText"
      md-items="item in ctrl.querySearch(ctrl.searchText)"
      md-item-text="item.name"
      placeholder="Type in the name of ingredient you want to add to this recipe">
      <span md-highlight-text="ctrl.searchText">{{item.name}}</span>
    </md-autocomplete>
    <md-list>
      <md-list-item class="md-3-line" ng-repeat="ingredient in ctrl.ingredients track by ingredient.name">
        <img ng-src="images/ingredient-icon.png" class="md-avatar">
        <div class="md-list-item-text" layout="row" layout-align="space-between">
          <div>
            <h3>{{ingredient.name}}</h3>

            <p>
              Calories: {{ctrl.getNutrientInfo(ingredient, 'energy')}}<br/>
              Fat: {{ctrl.getNutrientInfo(ingredient, 'fat', 1)}}
              Protein: {{ctrl.getNutrientInfo(ingredient, 'protein', 1)}}
              Carbohydrate: {{ctrl.getNutrientInfo(ingredient, 'carbohydrate', 1)}}
            </p>

            <div layout>
              <md-input-container style="width: 75px;">
                <label>Amount</label>
                <input type="number" ng-model="ingredient.chosenAmount" required>
              </md-input-container>
              <md-select ng-model="ingredient.chosenMeasure"
                         ng-change="ctrl.ingredientMeasureSelected(ingredient)"
                         placeholder="Measure">
                <md-option ng-value="$index" ng-repeat="measure in ingredient.nutrients.energy.measures">
                  {{measure.label}}
                </md-option>
              </md-select>
            </div>
          </div>
        </div>
        <md-divider ng-if="!$last"></md-divider>
      </md-list-item>
    </md-list>

    <md-input-container flex>
      <label>Time to cook</label>
      <input type="number" ng-model="recipe.timeToCook" required placeholder="Time to prepare this dish in minutes">
    </md-input-container>
    <md-input-container flex>
      <label>Cooking directions</label>
      <textarea ng-model="recipe.directions" columns="1" rows="6"></textarea>
    </md-input-container>

    <div layout="row" layout-align="space-between">
      <md-progress-linear md-mode="indeterminate" ng-show="ctrl.isLoading"></md-progress-linear>
      <md-button formnovalidate class="md-button-wide" ng-hide="ctrl.isLoading"
                 ui-sref="recipesList">
        go back
      </md-button>
      <md-button class="md-raised md-primary md-button-wide" ng-hide="ctrl.isLoading">
        create
      </md-button>
    </div>
  </form>
</md-content>
