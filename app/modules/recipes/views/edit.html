<form name="recipeForm" ng-controller="RecipeEditController as ctrl" ng-submit="ctrl.saveRecipe()">
  <md-toolbar class="md-hue-3">
    <div class="md-toolbar-tools">
      <md-button ui-sref="recipesList"
                 class="md-icon-button" aria-label="Close">
        <md-icon style="color: white;"
                 md-svg-icon="bower_components/material-design-icons/navigation/svg/design/ic_arrow_back_24px.svg">
      </md-button>
      <h2>
        <span ng-if="ctrl.isEdit == true">Edit Recipe</span>
        <span ng-if="ctrl.isEdit == false">Create New Recipe</span>
      </h2>
    </div>
  </md-toolbar>

  <div class="mp-content md-whiteframe-z1">
    <md-content class="md-padding">
      <div layout="column">
        <md-input-container flex>
          <label>Name</label>
          <input type="text" ng-model="ctrl.recipe.name" required>
        </md-input-container>
        <md-input-container flex>
          <label>Time to cook (minutes)</label>
          <input type="text" ng-model="ctrl.recipe.time_to_cook" required>
        </md-input-container>
        <div>
          <label>Yields servings</label>
          <md-select ng-model="ctrl.recipe.servings" placeholder="Please, select">
            <md-option ng-value="servings" ng-repeat="servings in [1, 2, 3, 4, 5, 6, 7, 8, 9, 10]">
              {{servings}}
            </md-option>
          </md-select>
        </div>
      </div>
      <h4>Ingredients</h4>
      <md-autocomplete
        md-delay="300"
        md-selected-item="ctrl.selectedItem"
        md-selected-item-change="ctrl.addIngredient(item)"
        md-search-text="ctrl.searchText"
        md-items="item in ctrl.querySearch(ctrl.searchText)"
        md-item-text="item.name"
        placeholder="Type in the name of ingredient you want to add to this recipe">
        <span md-highlight-text="ctrl.searchText">{{item.name}}</span>
      </md-autocomplete>
      <md-list>
        <md-list-item class="md-3-line" ng-repeat="ingredient in ctrl.ingredients track by $index">
          <img ng-src="images/ingredient-icon.png" class="md-avatar">

          <div class="md-list-item-text" layout="row" layout-align="space-between">
            <div flex>
              <h3 layout="row" layout-align="space-between">
                {{ingredient.short_name ? ingredient.short_name : ingredient.name}}
                <md-button type="button" ng-click="ctrl.removeIngredient($index)"
                           md-no-ink class="mp-action-button"
                           aria-label="Remove Ingredient">
                  <md-icon
                    md-svg-src="bower_components/material-design-icons/content/svg/design/ic_remove_circle_24px.svg">
                </md-button>
              </h3>

              <p>
                {{ctrl.getNutrientInfo(ingredient, 'energy')}}
                {{ctrl.getNutrientInfo(ingredient, 'fat', 1)}}
                {{ctrl.getNutrientInfo(ingredient, 'protein', 1)}}
                {{ctrl.getNutrientInfo(ingredient, 'carbohydrate', 1)}}
              </p>

              <div layout>
                <md-input-container style="width: 75px;">
                  <label>Amount</label>
                  <input type="number" ng-model="ingredient.chosenAmount" required>
                </md-input-container>
                <md-select ng-model="ingredient.chosenMeasure"
                           ng-change="ctrl.ingredientMeasureSelected(ingredient)"
                           placeholder="Measure">
                  <md-option ng-value="$index" ng-repeat="measure in ingredient.nutrients.energy.measures">
                    {{measure.label}}
                  </md-option>
                </md-select>
              </div>
            </div>
          </div>
          <md-divider md-inset="" ng-if="!$last"></md-divider>
        </md-list-item>
      </md-list>

      <h4>Cooking steps</h4>

      <div ng-repeat="step in ctrl.recipe.steps track by $index" layout="row">
        <md-input-container flex>
          <input ng-model="ctrl.recipe.steps[$index]" aria-label="Cooking step" required>
        </md-input-container>
        <md-button type="button" ng-click="ctrl.removeCookingStep($index)"
                   ng-show="ctrl.recipe.steps.length > 1"
                   md-no-ink class="mp-action-button"
                   aria-label="Remove Step">
          <md-icon md-svg-src="bower_components/material-design-icons/content/svg/design/ic_remove_circle_24px.svg">
        </md-button>
      </div>
      <div layout="row" layout-align="end">
        <md-button type="button" class="md-raised" ng-click="ctrl.addCookingStep()">
          add step
        </md-button>
      </div>
      <br/>

      <div layout="row" layout-align="space-between">
        <md-progress-linear md-mode="indeterminate" ng-show="ctrl.isLoading"></md-progress-linear>
        <md-button type="button" class="md-button-wide" ng-hide="ctrl.isLoading"
                   ui-sref="recipesList">
          go back
        </md-button>
        <md-button class="md-raised md-primary md-button-wide" ng-hide="ctrl.isLoading">
          save
        </md-button>
      </div>
    </md-content>
  </div>
</form>
